# Nome do binÃ¡rio do serviÃ§o
BINARY=eth-listener

# Caminho do diretÃ³rio do cÃ³digo fonte
SRC=cmd/server/main.go

# ConstruÃ§Ã£o do binÃ¡rio localmente
build:
	@echo "ğŸ”¨ Compilando o serviÃ§o..."
	go build -o $(BINARY) $(SRC)

# Limpeza dos arquivos compilados
clean:
	@echo "ğŸ§¹ Limpando arquivos compilados..."
	rm -f $(BINARY)

# Rodar o serviÃ§o localmente (fora do Docker)
run:
	@echo "ğŸš€ Rodando o serviÃ§o localmente..."
	go run $(SRC)

# ConstruÃ§Ã£o da imagem Docker
docker-build:
	@echo "ğŸ³ Construindo a imagem Docker..."
	docker build -t $(BINARY) .

# Rodar o serviÃ§o no Docker individualmente
docker-run:
	@echo "ğŸ³ Iniciando o contÃªiner Docker..."
	docker run --rm -p 8545:8545 --network=host $(BINARY)

# Subir tudo e iniciar o log
up-logs: up logs

# Subir toda a stack com Docker Compose
up:
	@echo "ğŸš€ Subindo toda a stack (Kafka + ServiÃ§o)..."
	docker-compose up --build -d

# Down nos contÃªineres do projeto
down:
	@echo "ğŸ›‘ Parando e removendo todos os serviÃ§os..."
	docker-compose down -v

# Stop nos contÃªineres do projeto
stop:
	@echo "ğŸ›‘ Parando todos os serviÃ§os..."
	docker-compose stop

# Restart no contÃªiner informado por parametro
restart:
	@echo "ğŸ”„ Reiniciando o serviÃ§o..."
	docker-compose restart $(service)

# Ver logs do serviÃ§o Go
logs:
	@echo "ğŸ“œ Logs do serviÃ§o..."
	docker-compose logs -f eth-listener

# log de um serviÃ§o especÃ­fico informado por argumento
log-%:
	@echo "ğŸ“œ Logs do serviÃ§o $*..."
	docker-compose logs -f $*

# Ver logs do Geth
logs-geth:
	@echo "ğŸ“œ Logs do nÃ³ Geth..."
	docker-compose logs -f geth

# Ver logs do Kafka
logs-kafka:
	@echo "ğŸ“œ Logs do Kafka..."
	docker-compose logs -f kafka

# Acessar o nÃ³ Geth via console
geth-console:
	@echo "ğŸ”§ Acessando console do Geth..."
	docker exec -it geth-node geth attach http://localhost:8545

# Remover contÃªineres e volumes
docker-reset:
	@echo "ğŸ—‘ï¸ Removendo contÃªineres e volumes..."
	docker-compose down -v
